var gulp=require("gulp"),$=require("gulp-load-plugins")({lazy:!0}),args=require("yargs").argv,config=require("./gulp.config"),util=require("util"),ignore=require("gulp-ignore"),rimraf=require("gulp-rimraf"),htmlhint=require("gulp-htmlhint"),uglify=require("gulp-uglify"),minifyHtml=require("gulp-minify-html"),minifyCss=require("gulp-minify-css");gulp.task("rimraf-it",function(){return gulp.src(config.rimraf2clean,{read:!1}).pipe(ignore("node_modules/**")).pipe(rimraf())}),gulp.task("phpunit",["rimraf-it"],function(){gulp.src("phpunit.xml").pipe($.phpunit("",{notify:!0}))}),gulp.task("checkstyle",function(){return gulp.src(config.configphp).pipe($.phpcs({bin:"vendor/bin/phpcs",standard:"PSR2",warningSeverity:0})).pipe($.phpcs.reporter("log"))}),gulp.task("sonar",function(){return gulp.src(config.configphp).pipe($.sonar(config.options)).on("error",util.log)}),gulp.task("jshint",function(){return gulp.src(config.configjs).pipe($["if"](args.verbose,$.print())).pipe($.jshint()).pipe($.jshint.reporter("jshint-stylish",{verbose:!0})).pipe($.jshint.reporter("fail"))}),gulp.task("csslint",function(){return gulp.src(config.configcss).pipe($.csslint()).pipe($.csslint.reporter())}),gulp.task("concat",function(){return gulp.src(config.concatsrc).pipe($.concat({path:"new.php",stat:{mode:777}})).pipe(gulp.dest("./concat/"))}),gulp.task("htmlhint",function(){return gulp.src(config.confightml).pipe(htmlhint()).pipe(htmlhint.failReporter())}),gulp.task("uglify",function(){return gulp.src(config.configjs).pipe(uglify()).pipe(gulp.dest(config.uglify_dest))}),gulp.task("minify-html",function(){var i={conditionals:!0,spare:!0};return gulp.src(config.confightml).pipe(minifyHtml(i)).pipe(gulp.dest(config.minifyHTML_dest))}),gulp.task("minify-css",function(){return gulp.src(config.configcss).pipe(minifyCss({compatibility:"ie8"})).pipe(gulp.dest(config.minifyCSS_dest))}),gulp.task("default",["rimraf-it","phpunit","checkstyle","sonar","jshint","csslint","concat","htmlhint","uglify","minify-html","minify-css"]),gulp.task("cpd",function(){return gulp.src(config.configphp).pipe($.phpcpd({bin:"./vendor/bin/phpcpd",minLines:20,minTokens:100,verbose:!0,reportFile:"./phpcpd.xml"}))}),gulp.task("phpspec",function(){var i={debug:!1},p={notify:!0},n={verbose:2};return gulp.src(config.configphp).pipe($.phpspec("./vendor/phpspec/ run",i,p,n))});